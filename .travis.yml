osx_image: xcode8.1
dist: xenial
language: C
sudo: required

#dist: trusty

# whitelist
branches:
  only:
   - develop

notifications:
  email: false

before_install:
    - |
      if [ "$(uname)" = "Linux" ]; then
         sudo apt-get update -qq;
         sudo apt-get install -qq gfortran;
         sudo apt-get install -y mpich2 libmpich2-3 libmpich2-dev;
      fi
#         sudo apt-get install -y hwloc ccache
#         sudo /usr/sbin/update-ccache-symlinks
#         export PATH="/usr/lib/ccache:$PATH"
#         wget http://www.mpich.org/static/downloads/3.3/mpich-3.3.tar.gz
#         tar -zxf mpich-3.3.tar.gz
#         cd $mpich-3.3
#         sh ./configure --prefix=$HOME/MPICH --enable-fc --enable-shared > /dev/null
#         make -j > /dev/null
#         sudo make install > /dev/null
#         ;;
    - test $(uname) = "Darwin" && brew update || true
    - test $(uname) = "Darwin" && brew tap homebrew/versions || true
    - test $(uname) = "Darwin" && brew install gcc@6 || true
    - test $(uname) = "Darwin" && brew link --overwrite gcc@6 || true

matrix:
   include:
     - os: linux
       compiler: gcc
       install: export CC="mpicc" export FC="mpif90" export F77="mpif90"
     - os: osx
       compiler: gcc
       install: export CC="gcc" export FC="gfortran-6" export F77="gfortran-6"

before_script:
    - ./bin/install-hdf.sh
    - ./bin/config-cgns.sh

script:
    - ./bin/build-cgns.sh
    
